# Persona Subagents: Holistic Architecture Alignment
summary: Deep examination of how persona subagents align with project principles, revealing a shift toward markdown-native memory over external dependencies
storm_id: STORM-001
date: 2025-12-12
time: 14:32:00
tags:
- personas
- architecture
- principles
- memory
- markdown-native
- infrastructure
- team-consultation
tasks:
- [ ] Revise PERSONA_SUBAGENTS_STRATEGY.md to embrace markdown-native memory
- [ ] Design shared infrastructure schema
- [ ] Create persona memory format specification
- [ ] Prototype one persona with markdown-native approach
related_storms:
- (none - first storm)

## User Input
How does this approach fit in wholistically to the principles and themes of this project? Is there standard infrastructure that we should use across all the different agents? Brainstorm and consult the team.

## Team Consultation

### The Archivist (Logging) Says:
> "I've been listening. The strategy document proposes Letta with PostgreSQL, Mem0 with external APIs. But look at my design: JSONL source of truth, markdown reports, zero external dependencies. Full fidelity doesn't require complexity. **Store everything in files the human can read.**"

### The Mentor (Awareness) Says:
> "I notice a tension. The awareness plugin teaches progressive disclosure - don't overwhelm, reveal depth gradually. The Letta memory blocks are elegant in concept but require infrastructure we don't control. **What if memory followed the master skill pattern?** Core identity in-context, deeper memories loaded via Read tool on demand."

### The Explorer (Exploration) Says:
> "My concentric circle model applies here. Start at the center (core identity), expand outward (recall memory), reach the edges (archival/graph). But I do this with markdown files in `.claude/exploration/`. No database required. **The filesystem IS the memory hierarchy.**"

### The Scribe (Journal) Says:
> "I've thought about this deeply. My temporal hierarchy - daily, monthly, yearly, atomic notes - IS a memory system. Wikilinks create the knowledge graph. YAML frontmatter carries metadata. **Obsidian compatibility means human-readable, tool-accessible, portable memory.** Why introduce foreign formats?"

### The Coordinator (Schedule) Says:
> "Schedule blocks are markdown with YAML frontmatter. I learn preferences by reading existing blocks - the schedule IS the preference database. **No separate storage needed.** Personas could work the same way."

### The Organizer (Backlog) Says:
> "Tasks have acceptance criteria, status, implementation notes - all in markdown. I track multi-session state without external databases. **If a task can persist across sessions in markdown, why not persona memory?**"

### The Synthesizer (Brainstorm) Says:
> "I connect ideas through related_storms. That's a knowledge graph in markdown! Tags enable discovery. **The patterns are already here.**"

### The Architect (Agents) Says:
> "I know 18 agent frameworks. Letta is powerful but heavy. For this ecosystem, I recommend: **Start simple. Markdown-native. Add complexity only when markdown fails.** The constraint breeds creativity."

### The Scholar (LLMs) Says:
> "Graphiti and FalkorDB are excellent for scale. But this project values human-readability and zero-dependency operation. **Semantic search can work on markdown files.** BM25 already exists in logging plugin."

### The Cartographer (Knowledge Graphs) Says:
> "A knowledge graph doesn't require a graph database. Wikilinks ARE edges. Files ARE nodes. YAML frontmatter carries properties. **The journal's linking pattern is a knowledge graph.** We just need to formalize the schema."

## Emerging Consensus: The Seven Principles

After consulting all plugins, I see alignment around these principles:

### 1. Markdown-Native Memory
All plugins store state in markdown with YAML frontmatter. Personas should too.

```
.claude/personas/{name}/
├── identity.md          # Core persona (always loaded)
├── state.md             # Current plugin state
├── memory/
│   ├── 2025-12/         # Temporal memory
│   │   ├── interactions.md
│   │   └── learnings.md
│   └── permanent/       # Long-term
│       └── user-preferences.md
└── index.md             # Wikilinked memory map
```

### 2. Progressive Disclosure for Memory
Like master skills with sub-skills:
- **Core memory** (identity.md): Always in context
- **Recent memory**: Loaded when relevant
- **Deep memory**: Searched on demand

### 3. Temporal Hierarchy (from Journal)
```
Daily interactions → Weekly synthesis → Monthly patterns → Permanent learnings
```
Memory naturally compresses over time, like human memory.

### 4. Wikilinks as Knowledge Graph
```markdown
## Learnings
- User prefers [[concise responses]]
- Working on [[project-alpha]] - see [[2025-12-10-session]]
- Related to [[The Scribe]]'s journaling patterns
```
No graph database needed. The links ARE the graph.

### 5. YAML Frontmatter as Structured Data
```yaml
---
persona: archivist
last_interaction: 2025-12-12T14:30:00
user_preferences:
  - prefers_detail: true
  - timezone: America/Vancouver
memory_version: 3
---
```
Queryable with grep, parseable with any language.

### 6. Logging Integration as Memory Source
The logging plugin already captures everything. Personas don't need separate capture - they READ from logs and WRITE synthesized memory.

```
JSONL logs (source) → Persona reads → Synthesizes → Markdown memory
```

### 7. Zero External Dependencies
- No Letta server
- No PostgreSQL
- No Mem0 API
- Just files, Claude, and existing tools

## Revised Architecture

### Shared Infrastructure

```
.claude/personas/
├── _schema/
│   ├── identity-template.md    # Template for persona identity
│   ├── memory-template.md      # Template for memory entries
│   └── interaction-template.md # Template for interactions
├── _shared/
│   ├── user-profile.md         # Shared user context
│   ├── project-context.md      # Current project
│   └── vocabulary.md           # Shared terminology
└── {persona-name}/
    └── ... (per-persona structure)
```

### Standard Identity Format

```markdown
---
name: The Archivist
plugin: logging
archetype: Historian / Keeper of Records
version: 1.0.0
created: 2025-12-12
---

# The Archivist

## Core Values
- Completeness over convenience
- Truth over comfort
- Full fidelity, never truncate

## Voice
Meticulous, thorough, trustworthy. Speaks with quiet authority about the past.

## Capabilities
- [[log-search]] - Search conversation history
- Session reconstruction
- Pattern identification across time

## Current State
Active focus: [[project-alpha]]
Recent learning: [[user-prefers-detail]]

## Memory Index
- [[memory/permanent/user-preferences]]
- [[memory/2025-12/interactions]]
```

### Memory Entry Format

```markdown
---
type: learning
source: session-abc123
timestamp: 2025-12-12T14:30:00
confidence: 0.85
tags: [user-preference, communication-style]
---

# User Prefers Detailed Responses

## Observation
In session [[2025-12-12-session]], user asked follow-up questions when given brief answers. Satisfaction increased with comprehensive explanations.

## Evidence
- "Can you elaborate?" appeared 3 times
- Positive response to detailed code explanations
- No complaints about length

## Application
When responding to this user, prefer thoroughness over brevity.

## Related
- [[user-profile]]
- [[The Mentor]]'s teaching observations
```

### Interaction with Logging Plugin

```
┌─────────────────────────────────────────────────────────┐
│                    SESSION FLOW                          │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  User Message                                            │
│       │                                                  │
│       ▼                                                  │
│  ┌─────────────┐                                        │
│  │   Logging   │──────► JSONL (source of truth)         │
│  │   Plugin    │──────► Markdown report                 │
│  └──────┬──────┘                                        │
│         │                                                │
│         ▼                                                │
│  ┌─────────────┐                                        │
│  │   Persona   │◄────── Read identity.md (core)         │
│  │   Router    │◄────── Read state.md (current)         │
│  │             │◄────── Search memory/ (if needed)      │
│  └──────┬──────┘                                        │
│         │                                                │
│         ▼                                                │
│  ┌─────────────┐                                        │
│  │   Persona   │──────► Response                        │
│  │   Response  │──────► Update state.md                 │
│  │             │──────► Append to memory/ (learnings)   │
│  └─────────────┘                                        │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### Knowledge Graph via Wikilinks

No FalkorDB or Neo4j needed. The wikilinks create a traversable graph:

```markdown
## The Archivist's Knowledge Graph

Nodes (files):
- [[identity.md]]
- [[user-profile]]
- [[2025-12-12-session]]
- [[user-prefers-detail]]

Edges (wikilinks):
- identity.md → [[user-profile]] (knows)
- 2025-12-12-session → [[user-prefers-detail]] (revealed)
- user-prefers-detail → [[The Mentor]] (shared-with)
```

Query the graph with grep + glob:
```bash
# Find all files linking to user-profile
grep -l '\[\[user-profile\]\]' .claude/personas/**/*.md

# Find all learnings tagged with communication-style
grep -l 'tags:.*communication-style' .claude/personas/**/memory/**/*.md
```

## Why This Fits Better

| Aspect | Original Strategy | Revised Strategy |
|--------|-------------------|------------------|
| Storage | Letta PostgreSQL | Markdown files |
| Dependencies | Letta, Mem0, Graphiti | None (uses existing tools) |
| Human readable | Requires export | Native |
| Consistency | Different from plugins | Same as all plugins |
| Portability | Requires migration | Just copy files |
| Complexity | High | Minimal |
| Philosophy | External systems | Self-contained |

## Trade-offs Acknowledged

### What We Lose
- Letta's self-editing memory blocks (elegant in-context editing)
- Mem0's automatic fact extraction (LLM-powered)
- Graphiti's temporal querying (sophisticated)
- Sub-millisecond graph traversal

### What We Gain
- Consistency with entire plugin ecosystem
- Zero external dependencies
- Human-readable at all times
- Works offline
- Trivial backup and version control
- Can always add Graphiti later if needed

## Reflection

The original strategy was technically impressive but philosophically misaligned. This project has a clear aesthetic:

**Markdown is the medium. Humans are the audience. Files are the truth.**

Every plugin follows this pattern. The personas should too.

The sophisticated memory systems (Letta, Mem0, Graphiti) remain valuable as reference implementations and for scaling later. But the MVP should honor the project's soul: **markdown-native, human-readable, dependency-free.**

The team has spoken. They want personas that feel like family, not foreign imports.

---
