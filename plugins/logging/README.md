# Claude Code Logging Plugin

Full-fidelity session logging with AI-summarized Markdown reports.

## Installation

```bash
/plugin install logging
```

## What It Does

Logs every hook event to JSONL (source of truth) and generates Markdown reports with AI summaries:

```
<project>/.claude/logging/YYYY/MM/DD/
â”œâ”€â”€ HH-MM-SS-{session}.jsonl       # Full data, never truncated
â”œâ”€â”€ HH-MM-SS-{session}.md          # Conversation-style report
â””â”€â”€ HH-MM-SS-{session}.cache.json  # Summary cache (auto-generated)
```

## Report Format

```markdown
# Session abc12345

**ID:** `abc12345-...`
**Started:** 2025-01-15 10:30:00

---

`10:30:00` ðŸ’« SessionStart startup

---

`10:30:05` ðŸ„ User: Refactor the logging plugin
> Help me refactor the logging plugin

<details>
<summary>ðŸ“¦ 3 tools: Read (2), Edit (1)</summary>

- Read `src/main.py`
- Read `src/utils.py`
- Edit `src/main.py`

</details>

<details>
<summary>`10:30:15` ðŸ”µ Subagent a1b2c3d4 (haiku): Analyzed codebase structure</summary>

**Prompt:**
> Search for all Python files in the project

**Tools:** 2
- Glob `**/*.py`
- Read `/src/main.py`

**Response:**
> Found 12 Python files across 3 directories...

</details>

<details>
<summary>`10:30:20` ðŸŒ² Claude: Refactored plugin to single file</summary>

> Done! I refactored the logging plugin to be more modular...

</details>
```

## AI Summaries

Each User prompt, Claude response, and Subagent response gets a 2-7 word summary generated by Haiku. Summaries are cached to avoid repeated API calls.

**Requirements:** Set `ANTHROPIC_API_KEY` environment variable.

**Without API key:** Logging works normally, summaries are just omitted.

**Cost:** ~$0.0005 per summary (~$0.003 per typical session).

## Querying JSONL

```bash
# View session events
cat .claude/logging/2025/12/08/*.jsonl | jq .

# Extract prompts
jq -r 'select(.type=="UserPromptSubmit") | .data.prompt' .claude/logging/*/*/*.jsonl

# Count events by type
jq -s 'group_by(.type) | map({type:.[0].type, n:length})' .claude/logging/*/*/*.jsonl
```

## Design

- **JSONL source of truth**: Append-only, full fidelity, never truncated
- **Markdown reports**: Regenerated from JSONL on key events
- **AI summaries**: 2-7 word Haiku-generated summaries with caching
- **Aggregated tools**: Grouped in collapsible details
- **Subagent details**: Model, prompt, tools, and response captured
- **Conversation format**: User/Claude exchanges with timestamps
